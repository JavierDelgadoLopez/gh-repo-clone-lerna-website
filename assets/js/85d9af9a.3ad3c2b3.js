"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[211],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),l=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=l(e.components);return a.createElement(i.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),d=l(n),h=r,m=d["".concat(i,".").concat(h)]||d[h]||p[h]||o;return n?a.createElement(m,s(s({ref:t},u),{},{components:n})):a.createElement(m,s({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=d;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:r,s[1]=c;for(var l=2;l<o;l++)s[l]=n[l];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3699:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var a=n(7462),r=(n(7294),n(3905));const o={id:"cache-tasks",title:"Cache Task Results",type:"recipe"},s="Cache Task Results",c={unversionedId:"features/cache-tasks",id:"features/cache-tasks",title:"Cache Task Results",description:'When it comes to running tasks, caching etc., Lerna and Nx can be used interchangeably. When we say "Lerna can cache',source:"@site/docs/features/cache-tasks.md",sourceDirName:"features",slug:"/features/cache-tasks",permalink:"/docs/features/cache-tasks",draft:!1,editUrl:"https://github.com/lerna/lerna/tree/main/website/docs/features/cache-tasks.md",tags:[],version:"current",frontMatter:{id:"cache-tasks",title:"Cache Task Results",type:"recipe"},sidebar:"main",previous:{title:"Run Tasks",permalink:"/docs/features/run-tasks"},next:{title:"Explore the Project Graph",permalink:"/docs/features/project-graph"}},i={},l=[{value:"Setup",id:"setup",level:2},{value:"Advanced Caching",id:"advanced-caching",level:2},{value:"Local Computation Caching",id:"local-computation-caching",level:2},{value:"Distributed Computation Caching",id:"distributed-computation-caching",level:2}],u={toc:l};function p(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"cache-task-results"},"Cache Task Results"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},'When it comes to running tasks, caching etc., Lerna and Nx can be used interchangeably. When we say "Lerna can cache\nbuilds", we mean that Lerna uses Nx which can cache builds.')),(0,r.kt)("p",null,"It's costly to rebuild and retest the same code over and over again. Lerna uses a computation cache to never rebuild the\nsame code twice."),(0,r.kt)("h2",{id:"setup"},"Setup"),(0,r.kt)("p",null,"Lerna via Nx has the most sophisticated and battle-tested computation caching system. It knows when the task you are\nabout to run has been executed before, so it can use the cache to restore the results of running that task."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"If you don't have ",(0,r.kt)("inlineCode",{parentName:"p"},"nx.json"),", run ",(0,r.kt)("inlineCode",{parentName:"p"},"npx lerna add-caching"),".")),(0,r.kt)("p",null,"To enable caching for ",(0,r.kt)("inlineCode",{parentName:"p"},"build")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"test"),", edit the ",(0,r.kt)("inlineCode",{parentName:"p"},"cacheableOperations")," property in ",(0,r.kt)("inlineCode",{parentName:"p"},"nx.json")," to include the ",(0,r.kt)("inlineCode",{parentName:"p"},"build")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"test")," tasks:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="nx.json"',title:'"nx.json"'},'{\n  "tasksRunnerOptions": {\n    "default": {\n      "runner": "nx/tasks-runners/default",\n      "options": {\n        "cacheableOperations": ["build", "test"]\n      }\n    }\n  }\n}\n')),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Note, ",(0,r.kt)("inlineCode",{parentName:"p"},"cacheableOperations")," need to be side effect free, meaning that given the same input they should always result in\nthe same output. As an example, e2e test runs that hit the backend API cannot be cached as the backend might influence\nthe result of the test run.")),(0,r.kt)("p",null,"Now, run the following command twice. The second time the operation will be instant:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"lerna run test --scope=header\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Terminal Output"',title:'"Terminal','Output"':!0},"> lerna run test --scope=header\n\n> header:test  [existing outputs match the cache, left as is]\n\n> header@0.1.0 test\n> jest\n\nPASS  src/Header.spec.tsx\n\u2713 renders header (12 ms)\n\nTest Suites: 1 passed, 1 total\nTests:       1 passed, 1 total\nSnapshots:   0 total\nTime:        0.439 s, estimated 1 s\nRan all test suites.\n\n\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\n\n>  Lerna (powered by Nx)   Successfully ran target test for project header (4ms)\n\n   Nx read the output from the cache instead of running the command for 1 out of 1 tasks.\n")),(0,r.kt)("h2",{id:"advanced-caching"},"Advanced Caching"),(0,r.kt)("p",null,"For a more in-depth understanding of the caching implementation and to fine-tune the caching for your repo, read ",(0,r.kt)("a",{parentName:"p",href:"../concepts/how-caching-works"},"How Caching Works"),"."),(0,r.kt)("h2",{id:"local-computation-caching"},"Local Computation Caching"),(0,r.kt)("p",null,"By default, Lerna (via Nx) uses a local computation cache. Nx stores the cached values only for a week, after which they\nare deleted. To clear the cache run ",(0,r.kt)("inlineCode",{parentName:"p"},"nx reset"),", and Nx will create a new one the next time it tries to access it."),(0,r.kt)("h2",{id:"distributed-computation-caching"},"Distributed Computation Caching"),(0,r.kt)("p",null,"The computation cache provided by Nx can be distributed across multiple machines. You can either build an implementation\nof the cache or use Nx Cloud. Nx Cloud is an app that provides a fast and zero-config implementation of distributed\ncaching. It's completely free for OSS projects and for most closed-sourced\nprojects (",(0,r.kt)("a",{parentName:"p",href:"https://dev.to/nrwl/more-time-saved-for-free-with-nx-cloud-4a2j"},"read more here"),")."),(0,r.kt)("p",null,"You can connect your workspace to Nx Cloud by running:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npx nx connect-to-nx-cloud\n")),(0,r.kt)("p",null,"Learn more about Nx Cloud at ",(0,r.kt)("a",{parentName:"p",href:"https://nx.app"},"https://nx.app"),"."))}p.isMDXComponent=!0}}]);