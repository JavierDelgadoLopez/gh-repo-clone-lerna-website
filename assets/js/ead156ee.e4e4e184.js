"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[339],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return h}});var n=a(7294);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,s=function(e,t){if(null==e)return{};var a,n,s={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}var u=n.createContext({}),l=function(e){var t=n.useContext(u),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=l(e.components);return n.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,s=e.mdxType,r=e.originalType,u=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),p=l(a),h=s,f=p["".concat(u,".").concat(h)]||p[h]||d[h]||r;return a?n.createElement(f,i(i({ref:t},c),{},{components:a})):n.createElement(f,i({ref:t},c))}));function h(e,t){var a=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var r=a.length,i=new Array(r);i[0]=p;var o={};for(var u in t)hasOwnProperty.call(t,u)&&(o[u]=t[u]);o.originalType=e,o.mdxType="string"==typeof e?e:s,i[1]=o;for(var l=2;l<r;l++)i[l]=a[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},6704:function(e,t,a){a.r(t),a.d(t,{assets:function(){return c},contentTitle:function(){return u},default:function(){return h},frontMatter:function(){return o},metadata:function(){return l},toc:function(){return d}});var n=a(7462),s=a(3366),r=(a(7294),a(3905)),i=["components"],o={id:"distribute-tasks",title:"Distribute Task Execution",type:"explanation"},u="Distribute Task Execution (DTE)",l={unversionedId:"features/distribute-tasks",id:"features/distribute-tasks",title:"Distribute Task Execution",description:"Lerna (via Nx) supports running commands across multiple machines. You can either set it up by hand (by using batching",source:"@site/docs/features/distribute-tasks.md",sourceDirName:"features",slug:"/features/distribute-tasks",permalink:"/docs/features/distribute-tasks",draft:!1,editUrl:"https://github.com/lerna/lerna/tree/main/website/docs/features/distribute-tasks.md",tags:[],version:"current",frontMatter:{id:"distribute-tasks",title:"Distribute Task Execution",type:"explanation"},sidebar:"main",previous:{title:"Explore the Project Graph",permalink:"/docs/features/project-graph"},next:{title:"Version and Publish",permalink:"/docs/features/version-and-publish"}},c={},d=[{value:"Set up",id:"set-up",level:2},{value:"What&#39;s a Task?",id:"whats-a-task",level:2},{value:"Nx Cloud Schedules Your CI Tasks Automatically",id:"nx-cloud-schedules-your-ci-tasks-automatically",level:2},{value:"Nx Cloud Efficiently Orchestrates Agents",id:"nx-cloud-efficiently-orchestrates-agents",level:2},{value:"Task Execution Order Matters",id:"task-execution-order-matters",level:2},{value:"Why Distribute Tasks?",id:"why-distribute-tasks",level:2},{value:"What Does It Cost?",id:"what-does-it-cost",level:2},{value:"Security",id:"security",level:2},{value:"Example",id:"example",level:2},{value:"Illustration",id:"illustration",level:2}],p={toc:d};function h(e){var t=e.components,o=(0,s.Z)(e,i);return(0,r.kt)("wrapper",(0,n.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"distribute-task-execution-dte"},"Distribute Task Execution (DTE)"),(0,r.kt)("p",null,"Lerna (via Nx) supports running commands across multiple machines. You can either set it up by hand (by using batching\nor\nbinning) or use Nx Cloud."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://blog.nrwl.io/distributing-ci-binning-and-distributed-task-execution-632fe31a8953?source=friends_link&sk=5120b7ff982730854ed22becfe7a640a"},"Read the comparison of the two approaches.")),(0,r.kt)("p",null,"We'll use some illustrations from Nrwlian Nicole Oliver to help explain Distributed Task Execution."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"how does distributed task execution work in Nx Cloud?",src:a(2855).Z,width:"900",height:"343"})),(0,r.kt)("h2",{id:"set-up"},"Set up"),(0,r.kt)("p",null,"To distribute your task execution, you need to (1) connect to Nx Cloud and (2) enable DTE in your CI workflow.  Each of these steps can be enabled with a single command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="1. Connect to Nx Cloud"',title:'"1.',Connect:!0,to:!0,Nx:!0,'Cloud"':!0},"nx connect-to-nx-cloud\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="2. Enable DTE in CI"',title:'"2.',Enable:!0,DTE:!0,in:!0,'CI"':!0},"nx generate @nrwl/workspace:ci-workflow --ci=github\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"--ci")," flag can be ",(0,r.kt)("inlineCode",{parentName:"p"},"github"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"circleci")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"azure"),".  For more details on setting up DTE, read ",(0,r.kt)("a",{parentName:"p",href:"https://nx.dev/nx-cloud/set-up/set-up-dte"},"this guide"),"."),(0,r.kt)("h2",{id:"whats-a-task"},"What's a Task?"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"what&#39;s a task? project + target (i.e. shared-product-ui + test).  each run contains many tasks.  affected:test contains shared-product-ui:test, product-page:test, shared-e2e-util:test and shared-ui:test",src:a(8098).Z,width:"680",height:"508"})),(0,r.kt)("p",null,"A task, from Lerna's perspective, is a target running on a project.  i.e. The target ",(0,r.kt)("inlineCode",{parentName:"p"},"test")," running on the project ",(0,r.kt)("inlineCode",{parentName:"p"},"shared-product-ui")," is a task.  For more information about tasks, see the ",(0,r.kt)("a",{parentName:"p",href:"./run-tasks"},"Run Tasks article"),"."),(0,r.kt)("h2",{id:"nx-cloud-schedules-your-ci-tasks-automatically"},"Nx Cloud Schedules Your CI Tasks Automatically"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"when you turn on DTE, Nx will schedule your commands&#39; tasks in CI.  for example, say you want to run these 3 commands to verify your code: nx affected --target=lint, nx affected --target=test and nx affected --target=build",src:a(9086).Z,width:"680",height:"526"})),(0,r.kt)("p",null,"Let's imagine for every PR in CI, you want to lint, test and build all affected projects.  When you write your CI workflow, you have no way of knowing how many projects will be affected by each PR or how long each task will take.  No matter how carefully you set things up, there will be wasted time if you manually assign a static number of agent machines for linting, testing and building.  This approach is called binning."),(0,r.kt)("p",null,"Luckily, with distributed task execution, Nx Cloud can dynamically assign tasks to agents as they become available."),(0,r.kt)("h2",{id:"nx-cloud-efficiently-orchestrates-agents"},"Nx Cloud Efficiently Orchestrates Agents"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Nx will automatically schedule tasks w/agents you assign in CI.",src:a(2319).Z,width:"680",height:"310"})),(0,r.kt)("p",null,"When you set up DTE, you define (1) the tasks that you want to run and (2) the number of agents that are available for Nx Cloud to use.  Then the Nx Cloud orchestrator distributes tasks to agents efficiently - so that all the agents are being fully utilized and your CI process finishes as soon as possible."),(0,r.kt)("h2",{id:"task-execution-order-matters"},"Task Execution Order Matters"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"but don&#39;t some tasks depend on others&#39; results?  Yep! Nx knows about your dependency tree, so it will execute tasks in the right order and make sure the results are available where they&#39;re needed.",src:a(5998).Z,width:"680",height:"557"})),(0,r.kt)("p",null,"There are some tasks that need to be executed before other tasks, but Nx Cloud takes that into account when it assigns tasks to agents.  For a more detailed look at defining those dependencies, read the ",(0,r.kt)("a",{parentName:"p",href:"./run-tasks"},"Run Tasks article"),"."),(0,r.kt)("h2",{id:"why-distribute-tasks"},"Why Distribute Tasks?"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Result: Faster Builds!",src:a(6082).Z,width:"680",height:"440"})),(0,r.kt)("p",null,"Efficiently parallelizing your CI process across many agents can dramatically speed up your CI, which helps developers identify problems faster and get more work done."),(0,r.kt)("h2",{id:"what-does-it-cost"},"What Does It Cost?"),(0,r.kt)("p",null,"Nx Cloud is FREE for open source projects.  Contact ",(0,r.kt)("a",{parentName:"p",href:"mailto:cloud-support@nrwl.io"},"cloud-support@nrwl.io")," to get set up."),(0,r.kt)("p",null,"For closed source projects, the first 500 computation hours per month are free.  Most workspaces don't exceed this amount.  No credit card is required.  After 500 hours, the cost is $1 per computation hour."),(0,r.kt)("p",null,"For more details, see the ",(0,r.kt)("a",{parentName:"p",href:"https://nx.app/pricing"},"Nx Cloud pricing page"),"."),(0,r.kt)("h2",{id:"security"},"Security"),(0,r.kt)("p",null,"Your actual code is not stored in the cloud, but the hashed inputs and cached results of your tasks are.  It is possible to enable end to end encryption of that data so that no one can view that information without your key.  Also, if you want to host Nx Cloud on your own servers, you can sign up for Nx Private Cloud."),(0,r.kt)("h2",{id:"example"},"Example"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/vsavkin/lerna-dte"},"This is an example repo")," showing how easy it is to set up distributed task\nexecution, showing the performance gains, and comparing to sharding/binning."),(0,r.kt)("h2",{id:"illustration"},"Illustration"),(0,r.kt)("p",null,"Here is the full illustrated explanation page that ",(0,r.kt)("a",{parentName:"p",href:"https://twitter.com/nixcodes"},"Nicole Oliver")," made:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"How Does DTE Work Explainer",src:a(3342).Z,width:"1668",height:"2388"})))}h.isMDXComponent=!0},6082:function(e,t,a){t.Z=a.p+"assets/images/faster-builds-59a232e5f98a04d44a5e2bc82eaff792.jpeg"},2855:function(e,t,a){t.Z=a.p+"assets/images/how-does-dte-work-577993a1c7e19ef801bc76623f3c58f0.jpeg"},3342:function(e,t,a){t.Z=a.p+"assets/images/nx-cloud-how-does-dte-work-65244729488886b3b40e4072491a3393.png"},9086:function(e,t,a){t.Z=a.p+"assets/images/schedule-tasks-71d06587de8f289c9955a1052051d2de.jpeg"},5998:function(e,t,a){t.Z=a.p+"assets/images/task-dependencies-ba3f69e12b4a12cac2454ce509aa58c3.jpeg"},2319:function(e,t,a){t.Z=a.p+"assets/images/use-agents-d6bc7fdc5c63f4a871171cf0cf63e114.jpeg"},8098:function(e,t,a){t.Z=a.p+"assets/images/whats-a-task-7552def96ccf59b70629c3afe745b61a.jpeg"}}]);